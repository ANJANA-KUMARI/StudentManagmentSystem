<?xml version="1.0" encoding="UTF-8"?>
<!-- by Anjana Kumari OOP SQL queries -->

<Querys>

	<Query-group name="create_sims_tables">
	
	

			<!-- Create table teacher_position Query -->
		<query id="create_teacher_position_table">
			<![CDATA[
				CREATE TABLE IF NOT EXISTS Position (
					id       INT NOT NULL AUTO_INCREMENT,
					position varchar(20) ,
					CONSTRAINT PK_position PRIMARY KEY (id)
					)	
			]]>
		</query>

	
				<!-- insert teacher_postion Query -->
		<query id="f">
			<![CDATA[
				DROP PROCEDURE IF EXISTS addPositions;
			]]>
		</query>
		
				<!-- insert teacher_postion Query -->
		<query id="f">
			<![CDATA[
			
				CREATE PROCEDURE  addPositions()
				BEGIN
					DECLARE count INT;
					SET count = (SELECT COUNT(*) FROM Position);
					
					IF count = 0 THEN
						INSERT INTO Position VALUES (1, 'Teacher'), (2, 'Class Administrator'), (3, 'Admin');
					END IF;
				END
			]]>
		</query>		

		
			<query id="f">
			<![CDATA[
				CALL addPositions();
			]]>
		</query>
	
		<!-- Create table Teacher Query -->
		<query id="create_teacher_table">
		<![CDATA[
			CREATE TABLE IF NOT EXISTS  Teacher ( 
				teacherID varchar(5) NOT NULL PRIMARY KEY,
				title varchar(4),
				firstName varchar(20),
				lastName varchar(20),
				section varchar(9),
				birthday date,
				email varchar(30),
				password varchar(60),	
				phone varchar(10),
				city varchar(10),
				state varchar(10),
				zip int,
				gender char(1),
				position int,
				imageName varchar(50),
				CONSTRAINT FK_Teacher_position FOREIGN KEY (position) REFERENCES Position (id)
		)
		]]>
		</query>
		
		
				<!-- insert teacher_postion Query -->
		<query id="f">
			<![CDATA[
				DROP PROCEDURE IF EXISTS addAdmin;
			]]>
		</query>
		
				<!-- insert teacher_postion Query -->
		<query id="f">
			<![CDATA[
			
				CREATE PROCEDURE  addAdmin()
				BEGIN
					DECLARE count INT;
					SET count = (SELECT COUNT(*) FROM Teacher WHERE position=3);
					
					IF count = 0 THEN
						INSERT INTO Teacher (teacherID, firstName,email, password, position) VALUES
						("TADM", "Admin" ,"admin@a.com", "$2a$10$t4l8ZImvomSw36EQq/dNx.qCHxw3FXyCYbHwC8WVmuoyT.wFbtJoC", 3  );
					END IF;
				END
			]]>
		</query>
	
		
		
			<query id="f">
			<![CDATA[
				CALL addAdmin();
			]]>
		</query>
		
		<!-- Create table Student Query -->
		<query id="create_student_table">
		<![CDATA[
			CREATE TABLE IF NOT EXISTS Student ( 
				studentID varchar(6) NOT NULL PRIMARY KEY,
				firstName varchar(20),
				lastName varchar(20),
				section varchar(9),
				birthday date,
				email varchar(30),
				phone varchar(10),
				city varchar(10),
				state varchar(10),
				zip int,
				gender char(1),
				grade varchar(3),
				roll INT ,
				imageName  varchar(20)

		)
		]]>
		</query>
		
		<!-- Create table Subject Query -->
		<query id="create_subject_table">
		<![CDATA[
			CREATE TABLE IF NOT EXISTS Subject (
				subjectID int NOT NULL AUTO_INCREMENT PRIMARY KEY,
				name varchar(20),
				section varchar(20),
				subjectHead varchar(5),				
				description varchar(100),
				CONSTRAINT FK_Subject_Teacher FOREIGN KEY (subjectHead) REFERENCES Teacher (teacherId)
		)
		]]>
		</query>
		
		<!-- Create table Exam Query -->
		<query id="create_exam_table">
		<![CDATA[
			CREATE TABLE IF NOT EXISTS Exam (
				examID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
				examName varchar(20),
				examDate date,	
				grade varchar(5)
		)
		]]>
		</query>
	
		
		
			<!-- Create table TeacherSubject Query -->
		<query id="create_teacherSubject_table">
		<![CDATA[
			CREATE TABLE IF NOT EXISTS TeacherSubject (
				teacherID varchar(5),
				subjectId int,
				CONSTRAINT PK_TeachSub PRIMARY KEY(teacherId, subjectId),
				CONSTRAINT FK_Teach FOREIGN KEY (teacherId) REFERENCES Teacher (teacherId) ON DELETE CASCADE,
				CONSTRAINT FK_Subj FOREIGN KEY (subjectId) REFERENCES Subject (subjectId ) ON DELETE CASCADE
		)
		]]>
		</query>
		
			<!-- Create table SubjectStudent Query -->
		<query id="create_subjectStudent_table">
		<![CDATA[
			CREATE TABLE IF NOT EXISTS SubjectStudent (
				subjectID int,
				studentID varchar(6),
				CONSTRAINT PK_SubStu PRIMARY KEY (subjectId, studentId),
				CONSTRAINT FK_Subjt FOREIGN KEY (subjectId) REFERENCES Subject (subjectId) ON DELETE CASCADE,
				CONSTRAINT FK_Stu FOREIGN KEY (studentId) REFERENCES Student (studentId) ON DELETE CASCADE
		)
		]]>
		</query>
		
			<!-- Create table SubjectExam Query -->
		<query id="create_subjectExam_table">
	<![CDATA[
		CREATE TABLE IF NOT EXISTS SubjectExam (
			subjectID int,
			examID INT,
			CONSTRAINT PK_SubExam PRIMARY KEY(subjectId, examId),
			CONSTRAINT FK_Sub FOREIGN KEY (subjectId) REFERENCES Subject (subjectId) ON DELETE CASCADE,
			CONSTRAINT FK_exam FOREIGN KEY (examId) REFERENCES Exam (examId) ON DELETE CASCADE
	)
	]]>
	</query>

	
		
		

	</Query-group>

	<Query-group name="drop_sims_tables">
	
		<!-- DROP TABLE TEACHER Query -->
		
		<query id="drop_table">
			<![CDATA[
				DROP TABLE IF EXISTS teacher
		]]>
		</query>
		
			<!-- DROP TABLE STUDENT Query -->
		<query id="drop_table">
			<![CDATA[
				DROP TABLE IF EXISTS student
		]]>
		</query>
		
			<!-- DROP TABLE SUBJECT Query -->
		<query id="drop_table">
			<![CDATA[
				DROP TABLE IF EXISTS subject
		]]>
		</query>
		
			<!-- DROP TABLE EXAM Query -->
		<query id="drop_table">
			<![CDATA[
				DROP TABLE IF EXISTS exam
		]]>
		</query>
	</Query-group>
	
	<Query-group name="general">
		<!-- Select all teacher Query -->
		<query id="insert_teacher">
			<![CDATA[
				INSERT INTO teacher (teacherID, title, firstName, lastName, section, birthday, email, password, phone, city, state, zip, gender, position, imageName)
				VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
			]]>
		</query>
		
			<!-- Select all student Query -->
		<query id="insert_student">
			<![CDATA[
				INSERT INTO student (studentID, firstName, lastName, section, birthday, email, phone, city, state, zip, gender, grade, roll, imageName)
				VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
			]]>
		</query>
		
			<!-- Select all subject Query -->
		<query id="insert_subject">
			<![CDATA[
				INSERT INTO subject (subjectID, name, section, subjectHead, description)
				VALUES (?, ?, ?, ?, ?)
			]]>
		</query>
		
			<!-- Select all exam Query -->
		<query id="insert_exam">
			<![CDATA[
				INSERT INTO exam (examID, examName, examDate, grade)
				VALUES (?, ?, ?, ?)
			]]>
		</query>
		
		
		<query id="insert_subject_student">
			<![CDATA[
				INSERT INTO SubjectStudent VALUES (?, ?) 
			]]>
		</query>

		<query id="insert_subject_teacher">
			<![CDATA[
				INSERT INTO TeacherSubject VALUES (?, ?) 
			]]>
		</query>
		
		<query id="insert_subject_exam">
			<![CDATA[
				INSERT INTO SubjectExam VALUES (?, ?) 
			]]>
		</query>
		

		<!-- Select a particular teacher by id Query -->
		<query id="teacher_by_id">
			<![CDATA[
				SELECT * 
				FROM teacher 
				WHERE teacherID = ?
			]]>
		</query>
		
				<query id="teacher_by_email">
			<![CDATA[
				SELECT * 
				FROM teacher 
				WHERE email = ?
			]]>
		</query>
		
			<!-- Select a particular student by id Query -->
		<query id="student_by_id">
			<![CDATA[
				SELECT * 
				FROM student 
				WHERE studentID = ?
			]]>
		</query>
		
			<!-- Select a particular subject by id Query -->
		<query id="subject_by_id">
			<![CDATA[
				SELECT * 
				FROM subject 
				WHERE subjectID = ?
			]]>
		</query>
		
			<!-- Select a particular exam by id Query -->
		<query id="exam_by_id">
			<![CDATA[
				SELECT * 
				FROM exam 
				WHERE examID = ?
			]]>
		</query>
	
	
		<!-- Select all teachers -->
		<query id="all_teachers">
			<![CDATA[
				SELECT t.teacherId, t.title, t.firstName, t.lastName, t.section, t.birthday
				,t.email, t.password, t.phone, t.city, t.state, t.zip, t.gender, p.position, t.imageName
				FROM teacher t, Position p
				WHERE t.position =p.id
			]]>
		</query>
		
			<!-- Select all students -->
		<query id="all_students">
			<![CDATA[
				SELECT *
				FROM student
			]]>
		</query>
		
			<!-- Select all subjects -->
		<query id="all_subjects">
			<![CDATA[
				SELECT *
				FROM subject
			]]>
		</query>
		
			<!-- Select all exams -->
		<query id="all_exams">
			<![CDATA[
				SELECT *
				FROM exam
			]]>
		</query>

			<!-- Select all exams -->
		<query id="teacher_ids">
			<![CDATA[
				SELECT teacherID
				FROM teacher
			]]>
		</query>
		
			<!-- Select all exams -->
		<query id="student_ids">
			<![CDATA[
				SELECT studentID
				FROM student
			]]>
		</query>
		
		
		<!-- Delete a particular teacher by id Query -->
		<query id="remove_teacher">
			<![CDATA[
				DELETE FROM teacher WHERE teacher.teacherID = ?
			]]>
		</query>
		
			<!-- Delete a particular student by id Query -->
		<query id="remove_student">
			<![CDATA[
				DELETE FROM student WHERE student.studentID = ?
			]]>
		</query>
		
			<!-- Delete a particular subject by id Query -->
		<query id="remove_subject">
			<![CDATA[
				DELETE FROM subject WHERE subject.subjectID = ?
			]]>
		</query>
		
			<!-- Delete a particular exam by id Query -->
		<query id="remove_exam">
			<![CDATA[
				DELETE FROM exam WHERE exam.examID = ?
			]]>
		</query>
		

	
		<!-- Update a particular teacher by id Query -->
		<query id="update_teacher">
			<![CDATA[
				UPDATE teacher AS t
				SET t.title = ?, t.firstName = ?, t.lastName = ?, t.section = ?, t.birthday = ?, t.email = ?, t.phone = ?, t.city = ?, t.state = ?, t.zip = ?, t.gender = ?, t.position=?, t.imageName = ?
				WHERE t.teacherID = ?
			]]>
		</query>
		
			<!-- Update a particular student by id Query -->
		<query id="update_student">
			<![CDATA[
				UPDATE student AS s
				SET s.firstName = ?, s.lastName = ?, s.section = ?, s.birthday = ?, s.email = ?, s.phone = ?, s.city = ?, s.state = ?, s.zip = ?, s.gender = ?, s.grade=?, s.roll=?, s.imageName= ?
				WHERE s.studentID = ?
			]]>
		</query>
		
			<!-- Update a particular subject by id Query -->
		<query id="update_subject">
			<![CDATA[
				UPDATE subject AS sub
				SET sub.name = ?, sub.section = ?, sub.subjectHead = ?,  sub.description = ?
				WHERE sub.subjectID = ?
			]]>
		</query>
		
			<!-- Update a particular exam by id Query -->
		<query id="update_exam">
			<![CDATA[
				UPDATE exam AS e
				SET e.examName = ?, e.examDate = ?, e.grade = ?
				WHERE e.examID = ?
			]]>
		</query>
	
		<!-- Get teacher IDs Query -->
		<query id="teacher_ids">
			<![CDATA[
				SELECT t.teacherID
				FROM teacher 
				AS t
			]]>
		</query>
		
			<!-- Get student IDs Query -->
		<query id="student_ids">
			<![CDATA[
				SELECT s.studentID
				FROM student 
				AS s
			]]>
		</query>
		
			<!-- Get subject IDs Query -->
		<query id="subject_ids">
			<![CDATA[
				SELECT sub.subjectID
				FROM subject 
				AS sub
			]]>
		</query>
		
			<!-- Get exam IDs Query -->
		<query id="exam_ids">
		<![CDATA[
			SELECT e.examID
			FROM exam
			AS e
		]]>
	</query>
	
			<!-- select_teacher_admin_count Query -->
		<query id="admin_count">
			<![CDATA[
				SELECT COUNT(*)
				FROM Teacher
				WHERE teacher_position_id = 1
			]]>	
		</query>
		
			<!-- select_teacher_email_pwd Query -->
		<query id="admin_email_pwd">
			<![CDATA[
				SELECT password
				FROM Teacher
				WHERE email = ?
			]]>
		</query>
		
		
			<!-- select_teacher_email_pwd Query -->
		<query id="subject_of_student">
			<![CDATA[
				SELECT sub.subjectId, sub.name, sub.section, sub.subjectHead, sub.description
				FROM subject sub,  SubjectStudent ss
				WHERE ss.studentID = ?
				AND sub.subjectId = ss.subjectID
			]]>
		</query>
		
		
			<!-- select_teacher_email_pwd Query -->
		<query id="subject_of_teacher">
			<![CDATA[
					SELECT sub.subjectId, sub.name, sub.section, sub.subjectHead, sub.description
				FROM subject sub,  TeacherSubject ss
				WHERE ss.teacherId = ?
				AND sub.subjectId = ss.subjectId
			]]>
		</query>
		
		
			<!-- select_teacher_email_pwd Query -->
		<query id="subject_of_exam">
			<![CDATA[
		SELECT sub.subjectId, sub.name, sub.section, sub.subjectHead, sub.description
				FROM subject sub,  SubjectExam ss
				WHERE ss.examID = ?
				AND sub.subjectId = ss.subjectID
			]]>
		</query>

	</Query-group>
	
	
	

</Querys>